<!-- TODO: Check all the text on this page -->
<mat-stepper
  [orientation]="stepperVertical ? 'vertical' : 'horizontal'"
  labelPosition="bottom" linear #stepper
  (selectionChange)="stepperSelectionChange($event.selectedIndex)">
  <mat-step *ngIf="!!showDonationLengths" [editable]="canEdit" [completed]="!canEdit || donationLengthComplete">
    <ng-template matStepLabel>Donation Length</ng-template>
    <p *ngIf="showBackdatingNote">
      Note: If the period you select has already begun you will be charged a lump sum for the days you have missed,
      so you can make up those donations and inshallah still receive the reward.
    </p>
    <button
      mat-raised-button color="primary"
      *ngFor="let donationLength of (showDonationLengths || []); first as isFirst"
      (click)="selectDonationLength(donationLength)" [class.firstBtn]="isFirst"
    >{{getDonationLengthText(donationLength)}}</button>
  </mat-step>

  <mat-step [editable]="canEdit" [completed]="!canEdit || donationAmountComplete">
    <ng-template matStepLabel>Daily Amount</ng-template>
    <ng-container *ngIf="!!showPresetAmounts">
      <div class="amounts-container">
        <button
          mat-raised-button color="primary"
          *ngFor="let presetAmount of (showPresetAmounts || []); first as isFirst"
          [class.firstBtn]="isFirst"
          (click)="setAmount(presetAmount)"
        >£{{presetAmount}} / day</button>
        <button
          mat-raised-button color="primary" *ngIf="!showCustomAmount"
          (click)="showCustomAmount = true"
        >Other Amount</button>
      </div>
      <mat-divider *ngIf="showCustomAmount"></mat-divider>
    </ng-container>
    <ng-container *ngIf="showCustomAmount || !showPresetAmounts">
      <div class="custom-amounts-container">
        <mat-form-field floatLabel="always">
          <mat-label>Custom Amount</mat-label>
          <input matInput type="number" placeholder="0.00"  [formControl]="amount">
          <span matTextPrefix>£&nbsp;</span>
          <span matTextSuffix="">/day</span>
          <mat-error *ngIf="amount.invalid">{{errorMessage(amount)}}</mat-error>
        </mat-form-field>
      </div>
      <div class="actions-container" id="custom-amount-btn-container">
        <button mat-raised-button color="primary" matStepperNext [disabled]="!donationAmountComplete">NEXT</button>
      </div>
    </ng-container>
  </mat-step>

  <mat-step [editable]="canEdit" [completed]="!canEdit || donationDetailsComplete">
    <ng-template matStepLabel>Details</ng-template>
    <h2>Contact Details:</h2>
    <mat-form-field>
      <mat-label>First Name(s)</mat-label>
      <input matInput placeholder="First Name(s)" [formControl]="donorInfo.controls.firstName">
      <mat-error *ngIf="donorInfo.controls.firstName.invalid">{{errorMessage(donorInfo.controls.firstName)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
    <mat-label>Surname</mat-label>
    <input matInput placeholder="Surname" [formControl]="donorInfo.controls.surname">
    <mat-error *ngIf="donorInfo.controls.surname.invalid">{{errorMessage(donorInfo.controls.surname)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Email</mat-label>
      <input matInput placeholder="xxx@example.com" [formControl]="donorInfo.controls.email">
      <mat-error *ngIf="donorInfo.controls.email.invalid">{{errorMessage(donorInfo.controls.email)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Phone Number</mat-label>
      <input matInput placeholder="+XX XXXX XXXXXX" [formControl]="donorInfo.controls.phone">
      <mat-error *ngIf="donorInfo.controls.phone.invalid">{{errorMessage(donorInfo.controls.phone)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Address</mat-label>
      <input matInput placeholder="309-313 Mill Rd, Cambridge, UK" [formControl]="donorInfo.controls.address">
      <mat-error *ngIf="donorInfo.controls.address.invalid">{{errorMessage(donorInfo.controls.address)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
    <mat-label>Post Code</mat-label>
    <input matInput placeholder="CB1 3DF" [formControl]="donorInfo.controls.postcode">
    <mat-error *ngIf="donorInfo.controls.postcode.invalid">{{errorMessage(donorInfo.controls.postcode)}}</mat-error>
    </mat-form-field>
    <h2>Donate on behalf of:</h2>
    <h3>(Can be yourself or someone else)</h3>
    <p>
      If you are gifted a framed brick, this name will be on the plaque.
      If you are listed on the digital wall of donors, this name will be on the wall.<br/>
      Max 25 characters.
    </p>
    <mat-form-field>
      <mat-label>Name</mat-label>
      <input matInput [formControl]="donationInfo.controls.onBehalfOf" placeholder="Donate on behalf of">
      <mat-error *ngIf="donationInfo.controls.onBehalfOf.invalid">{{errorMessage(donationInfo.controls.onBehalfOf)}}</mat-error>
    </mat-form-field>
    <p>If you do not wish the name to be noted on our website and other media, please check the anonymous option.</p>
    <mat-slide-toggle color="primary" [formControl]="donationInfo.controls.anonymous">Anonymous</mat-slide-toggle>
    <h2>Consent</h2>
    <h4>Gift Aid</h4>
    <p [innerHTML]="giftAidDisclaimer"></p>
    <mat-slide-toggle [formControl]="donorInfo.controls.giftAid" color="primary">Consent to Gift Aid</mat-slide-toggle>
    <h4>Disclaimer</h4>
    <p [innerHTML]="disclaimer"></p>
    <mat-slide-toggle [formControl]="consent.controls.disclaimer" color="primary">Accept the disclaimer</mat-slide-toggle>
    <h4>Data and Privacy Policy</h4>
    <mat-slide-toggle [formControl]="consent.controls.privacy" color="primary">
      Accept our <a href="https://cambridgecentralmosque.org/legal/" target="_blank" rel="noopener noreferer">Data & Privacy Policy</a>
    </mat-slide-toggle>
    <div class="actions-container">
      <button mat-stroked-button matStepperPrevious>BACK</button>
      <button mat-raised-button color="primary" matStepperNext [disabled]="!donationDetailsComplete">NEXT</button>
    </div>
  </mat-step>

  <mat-step [editable]="checkoutState !== checkoutStates.COMPLETE" [completed]="checkoutState === checkoutStates.COMPLETE" #checkoutStep>
    <ng-template matStepLabel>Setup</ng-template>
    <div class="loading-container">
      <mat-progress-bar
        *ngIf="checkoutLoadingState.show"
        [mode]="checkoutLoadingState.mode"
        [value]="checkoutLoadingState.value"
        color="primary"
      ></mat-progress-bar>
    </div>
    <ng-container *ngIf="checkoutSummary != null">
      <h2>Summary:</h2>
      <p>Daily Amount: <b>{{checkoutSummary.amount | currency:"GBP"}} / day</b></p>
      <p>Start Date: <b>{{numberToDate(checkoutSummary.startDate) | date:"dd/MM/yyyy"}}</b></p>
      <p>Duration: <b>{{checkoutSummary.iterations}} days</b></p>
      <br/>
      <p>On behalf of: <b>{{checkoutSummary.onBehalfOf}}</b></p>
      <p>Anonymous: <b>{{checkoutSummary.anonymous}}</b></p>
      <br/>
      <p>First Name: <b>{{checkoutSummary.firstName}}</b></p>
      <p>Surname: <b>{{checkoutSummary.surname}}</b></p>
      <p>Email: <b>{{checkoutSummary.email}}</b></p>
      <p>Phone Number: <b>{{checkoutSummary.phone}}</b></p>
      <p>Address: <b>{{checkoutSummary.address}}</b></p>
      <p>Postcode: <b>{{checkoutSummary.postcode}}</b></p>
      <p>Gift Aid: <b>{{checkoutSummary.giftAid ? "Yes" : "No"}}</b></p>
    </ng-container>
    <ng-container *ngIf="checkoutState === checkoutStates.NOT_BEGUN">
      <h2>Setup the Donation</h2>
      <p>
        The "SETUP DONATION" button below will allow you to enter your payment details. It will then bring you back to this page as you donation is setup.
        Please do not close the page.<br/>
        <b>Please note the transaction fees are lower when paying via direct debit, so please prefer this payment option if possible.</b>
      </p>
      <div class="actions-container">
        <button mat-stroked-button matStepperPrevious>BACK</button>
        <button mat-raised-button color="primary" (click)="setupPayment()">SETUP DONATION</button>
      </div>
    </ng-container>
  </mat-step>

  <mat-step [editable]="!canEdit">
    <ng-template matStepLabel>Complete</ng-template>
    <h2>
      Your Day By Day donation has been setup!<br/>
      You should have received a confirmation email confirming the details,
      including whether you are amongst those who will be recieving a framed brick as a gift.
    </h2>
    <ng-container *ngIf="fullSummary !== null">
      <h3>Summary:</h3>
      <p>Daily Amount: <b>{{fullSummary.amount | currency:"GBP"}} / day</b></p>
      <p>Start Date: <b>{{numberToDate(fullSummary.startDate) | date:"dd/MM/yyyy"}}</b></p>
      <p>Duration: <b>{{fullSummary.iterations}} days</b></p>
      <br/>
      <p>On behalf of: <b>{{fullSummary.onBehalfOf}}</b></p>
      <p>Anonymous: <b>{{fullSummary.anonymous}}</b></p>
      <br/>
      <p>First Name: <b>{{fullSummary.firstName}}</b></p>
      <p>Surname: <b>{{fullSummary.surname}}</b></p>
      <p>Email: <b>{{fullSummary.email}}</b></p>
      <p>Phone Number: <b>{{fullSummary.phone}}</b></p>
      <p>Address: <b>{{fullSummary.address}}</b></p>
      <p>Postcode: <b>{{fullSummary.postcode}}</b></p>
      <br/>
      <p>Gift Aid: <b>{{fullSummary.giftAid ? "Yes" : "No"}}</b></p>
      <p>Date of consent to Gift Aid: <b>{{numberToDate(fullSummary.giftAidConsentDate) | date:"dd/MM/yyyy"}}</b></p>
    </ng-container>

    <button mat-raised-button color="primary" (click)="goToMainSite()">Return to Main Website</button>
  </mat-step>
</mat-stepper>
