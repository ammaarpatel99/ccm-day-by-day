<!-- TODO: Check all the text on this page -->
<mat-stepper orientation="vertical" linear #stepper (selectionChange)="stepperSelectionChange($event.selectedIndex)">
  <mat-step *ngIf="!!showDonationLengths" [editable]="canEdit" [completed]="!canEdit || donationLengthComplete">
    <ng-template matStepLabel>How Long Would You Like To Donate For?</ng-template>
    <p *ngIf="showBackdatingNote">
      Note: If the period you select has already begun you will be charged a lump sum for the days you have missed,
      so you can make up those donations and inshallah still receive the reward.
    </p>
    <button
      mat-raised-button color="primary"
      *ngFor="let donationLength of (showDonationLengths || [])"
      (click)="selectDonationLength(donationLength)"
    >{{getDonationLengthText(donationLength)}}</button>
  </mat-step>

  <mat-step [editable]="canEdit" [completed]="!canEdit || donationAmountComplete">
    <ng-template matStepLabel>Choose Your Daily Amount</ng-template>
    <ng-container *ngIf="!!showPresetAmounts">
      <div class="amounts-container">
        <button
          mat-raised-button color="primary"
          *ngFor="let presetAmount of (showPresetAmounts || [])"
          (click)="setAmount(presetAmount)"
        >{{presetAmount | currency:"GBP"}}</button>
      </div>
      <mat-divider></mat-divider>
    </ng-container>
    <div class="custom-amounts-container">
      <mat-form-field floatLabel="always">
        <mat-label>Custom Amount</mat-label>
        <input matInput type="number" placeholder="0.00"  [formControl]="amount">
        <span matTextPrefix>Â£&nbsp;</span>
      </mat-form-field>
    </div>
    <div class="actions-container">
      <button mat-stroked-button matStepperPrevious>BACK</button>
      <button mat-stroked-button color="primary" matStepperNext>NEXT</button>
    </div>
  </mat-step>

  <mat-step [editable]="canEdit" [completed]="!canEdit || donationDetailsComplete">
    <ng-template matStepLabel>Details</ng-template>
    <h2>Donor Details:</h2>
    <p>
      Your name or the name of whoever you wish to donate on behalf of. Max 25 character.
      <span *ngIf="eligibleForBrick">
        If you are amongst those gifted a framed brick, this name will be on the plaque.
      </span>
    </p>
    <mat-form-field>
      <mat-label>Name</mat-label>
      <input matInput [formControl]="donorInfo.controls.name">
    </mat-form-field>
    <p>If you do not wish your donation to be noted on our website and other media, please check the anonymous option.</p>
    <mat-slide-toggle color="primary" [formControl]="donorInfo.controls.anonymous">Anonymous</mat-slide-toggle>
    <ng-container *ngIf="eligibleForBrick">
      <p>
        Of those who complete the full Day By Day donation scheme of {{minimumAmount | async | currency:"GBP"}} per day,
        the first 300 who signed up will be gifted a framed brick from the Cambridge Central Mosque at a ceremony with Sheikh Abdal Hakim Murad.
        There is more information on our <a href="https://cambridgecentralmosque.org/daybyday" target="_blank" rel="noopener noreferer">website</a>.
        <br/>
        If you are eligible, would you like to receive the gift?
      </p>
      <mat-slide-toggle color="primary" [formControl]="donorInfo.controls.wantsBrick">
        Receive Framed Brick if Eligible
      </mat-slide-toggle>
    </ng-container>
    <h2>Contact Details:</h2>
    <mat-form-field>
      <mat-label>Email</mat-label>
      <input matInput placeholder="xxx@example.com" [formControl]="contactInfo.controls.email">
    </mat-form-field>
    <mat-form-field>
      <mat-label>Phone Number</mat-label>
      <input matInput placeholder="+XX XXXX XXXXXX" [formControl]="contactInfo.controls.phone">
    </mat-form-field>
    <h2>Consent</h2>
    <p>
      If you are a UK taxpayer and are eligible for Gift Aid, you may select the below option.
      If you do we will get in touch regarding registering your Day By Day donation for Gift Aid, which will result
      in the <b>government contributing an additional 25%</b> to your donation.
    </p>
    <mat-slide-toggle [formControl]="consent.controls.giftAid" color="primary">Gift Aid</mat-slide-toggle>
    <mat-slide-toggle [formControl]="consent.controls.privacy" color="primary">
      Accept our <a href="https://cambridgecentralmosque.org/legal/" target="_blank" rel="noopener noreferer">Data & Privacy Policy</a>
    </mat-slide-toggle>
    <p>
      Disclaimer - All money given to the Cambridge Central Mosque through this scheme is a donation to the
      Cambridge Mosque Trust. Any framed bricks distributed are gifts given at the Trust's discretion
      in line with their Day By Day Ramadan 2023 Scheme. The Trust may change the Terms of the Day By Day Scheme
      at its discretion.<br/>
      The donations are processed by Stripe, who take a transaction fee which varies depending on the payment method.
    </p>
    <mat-slide-toggle [formControl]="consent.controls.disclaimer" color="primary">I accept the disclaimer</mat-slide-toggle>
    <div class="actions-container">
      <button mat-stroked-button matStepperPrevious>BACK</button>
      <button mat-stroked-button color="primary" matStepperNext>NEXT</button>
    </div>
  </mat-step>

  <mat-step [editable]="checkoutState !== checkoutStates.COMPLETE" [completed]="checkoutState === checkoutStates.COMPLETE">
    <ng-template matStepLabel>Setup Your Donation</ng-template>
    <div class="loading-container">
      <mat-progress-bar
        *ngIf="checkoutLoadingState.show"
        [mode]="checkoutLoadingState.mode"
        [value]="checkoutLoadingState.value"
        color="primary"
      ></mat-progress-bar>
    </div>
    <ng-container *ngIf="checkoutSummary != null">
      <h2>Summary:</h2>
      <p>Daily Amount: {{checkoutSummary.amount | currency:"GBP"}}</p>
      <p>Start Date: {{checkoutSummary.startDate | date:"dd/MM/yyyy"}}</p>
      <p>Duration: {{checkoutSummary.iterations}}</p>
      <br/>
      <p>Name: {{checkoutSummary.name}}</p>
      <p>Anonymous: {{checkoutSummary.anonymous}}</p>
      <p *ngIf="checkoutSummary.eligibleForBrick">Receive Framed Brick if Eligible: {{checkoutSummary.wantsBrick}}</p>
      <br/>
      <p>Email: {{checkoutSummary.email}}</p>
      <p>Phone Number: {{checkoutSummary.phone}}</p>
      <p>Gift Aid: {{checkoutSummary.giftAid ? "Yes" : "No"}}</p>
    </ng-container>
    <ng-container *ngIf="checkoutState === checkoutStates.NOT_BEGUN">
      <h2>Setup the Donation</h2>
      <p>
        The "SETUP DONATION" button below will allow you to enter your payment details. It will then bring you back to this page as you donation is setup.
        Please do not close the page.<br/>
        <b>Please note the transaction fees are lower when paying via direct debit, so please prefer this payment option if possible.</b>
      </p>
      <div class="actions-container">
        <button mat-stroked-button matStepperPrevious>BACK</button>
        <button mat-stroked-button color="primary" (click)="setupPayment()">SETUP DONATION</button>
      </div>
    </ng-container>
  </mat-step>

  <mat-step [editable]="!canEdit">
    <h2>
      Your Day By Day donation has been setup!<br/>
      You should have received a confirmation email confirming the details.
    </h2>
    <h3>Summary:</h3>
    <p>ID: {{fullSummary!.subscriptionID}}</p>
    <br/>
    <p>Daily Amount: {{fullSummary!.amount | currency:"GBP"}}</p>
    <p>Start Date: {{fullSummary!.startDate | date:"dd/MM/yyyy"}}</p>
    <p>Duration: {{fullSummary!.iterations}}</p>
    <br/>
    <p>Name: {{fullSummary!.name}}</p>
    <p>Anonymous: {{fullSummary!.anonymous}}</p>
    <p *ngIf="fullSummary!.eligibleForBrick">Receive Framed Brick if Eligible: {{fullSummary!.wantsBrick}}</p>
    <br/>
    <p>Email: {{fullSummary!.email}}</p>
    <p>Phone Number: {{fullSummary!.phone}}</p>
    <p>Gift Aid: {{fullSummary!.giftAid ? "Yes" : "No"}}</p>
    <button mat-stroked-button color="primary" (click)="goToMainSite()">Return to Main Website</button>
  </mat-step>
</mat-stepper>
